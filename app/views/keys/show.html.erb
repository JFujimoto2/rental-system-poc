<% content_for :title, "鍵詳細" %>

<h1>鍵詳細</h1>

<table class="detail-table">
  <tr><th>部屋</th><td><%= link_to "#{@key.room.building.name} #{@key.room.room_number}", @key.room %></td></tr>
  <tr><th>鍵種別</th><td><%= @key.key_type_label %></td></tr>
  <tr><th>鍵番号</th><td><%= @key.key_number %></td></tr>
  <tr><th>状態</th><td><%= @key.status_label %></td></tr>
  <tr><th>備考</th><td><%= @key.notes %></td></tr>
</table>

<div class="actions-bar">
  <%= link_to "編集", edit_key_path(@key), class: "btn" %>
  <%= link_to "一覧に戻る", keys_path, class: "btn" %>
  <%= button_to "削除", @key, method: :delete, class: "btn btn-danger", data: { turbo_confirm: "#{@key.key_number} を削除しますか？" } %>
</div>

<h2>鍵履歴</h2>

<% if @key.key_histories.any? %>
  <table>
    <thead>
      <tr>
        <th>アクション</th>
        <th>入居者</th>
        <th>実施日</th>
        <th>備考</th>
      </tr>
    </thead>
    <tbody>
      <% @key.key_histories.includes(:tenant).order(acted_on: :desc).each do |history| %>
        <tr>
          <td><%= history.action_label %></td>
          <td><%= link_to history.tenant.name, history.tenant if history.tenant %></td>
          <td><%= history.acted_on %></td>
          <td><%= history.notes %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>鍵履歴がありません。</p>
<% end %>
