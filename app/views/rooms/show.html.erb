<% content_for :title, "#{@room.building.name} #{@room.room_number}" %>


<h1><%= @room.building.name %> <%= @room.room_number %></h1>

<table class="detail-table">
  <tr><th>建物</th><td><%= link_to @room.building.name, @room.building %></td></tr>
  <tr><th>部屋番号</th><td><%= @room.room_number %></td></tr>
  <tr><th>階数</th><td><%= @room.floor %></td></tr>
  <tr><th>間取り</th><td><%= @room.room_type %></td></tr>
  <tr><th>面積</th><td><%= "#{@room.area} ㎡" if @room.area %></td></tr>
  <tr><th>賃料</th><td><%= number_to_currency(@room.rent, unit: "¥", precision: 0) if @room.rent %></td></tr>
  <tr><th>状態</th><td><%= @room.status_label %></td></tr>
  <tr><th>備考</th><td><%= @room.notes %></td></tr>
</table>

<div class="actions-bar">
  <%= link_to "編集", edit_room_path(@room), class: "btn" %>
  <%= link_to "一覧に戻る", rooms_path, class: "btn" %>
  <%= button_to "削除", @room, method: :delete, class: "btn btn-danger", data: { turbo_confirm: "#{@room.room_number} を削除しますか？" } %>
</div>

<h2>契約履歴</h2>

<% if @room.contracts.any? %>
  <table>
    <thead>
      <tr>
        <th>入居者</th>
        <th>借家種別</th>
        <th>契約開始日</th>
        <th>契約終了日</th>
        <th>月額賃料</th>
        <th>状態</th>
      </tr>
    </thead>
    <tbody>
      <% @room.contracts.includes(:tenant).order(start_date: :desc).each do |contract| %>
        <tr>
          <td><%= link_to contract.tenant.name, contract.tenant %></td>
          <td><%= contract.lease_type_label %></td>
          <td><%= contract.start_date %></td>
          <td><%= contract.end_date %></td>
          <td><%= number_to_currency(contract.rent, unit: "¥", precision: 0) if contract.rent %></td>
          <td><%= link_to contract.status_label, contract %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>契約履歴がありません。</p>
<% end %>

<h2>工事履歴</h2>

<% if @room.constructions.any? %>
  <table>
    <thead>
      <tr>
        <th>工事件名</th>
        <th>工事種別</th>
        <th>業者</th>
        <th>見積金額</th>
        <th>実績金額</th>
        <th>状態</th>
      </tr>
    </thead>
    <tbody>
      <% @room.constructions.includes(:vendor).order(created_at: :desc).each do |construction| %>
        <tr>
          <td><%= link_to construction.title, construction %></td>
          <td><%= construction.construction_type_label %></td>
          <td><%= link_to construction.vendor.name, construction.vendor if construction.vendor %></td>
          <td><%= number_to_currency(construction.estimated_cost, unit: "¥", precision: 0) if construction.estimated_cost %></td>
          <td><%= number_to_currency(construction.actual_cost, unit: "¥", precision: 0) if construction.actual_cost %></td>
          <td><%= construction.status_label %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>工事履歴がありません。</p>
<% end %>

<%= link_to "この部屋に工事を追加", new_construction_path(room_id: @room.id), class: "btn btn-primary" %>

<h2>鍵一覧</h2>

<% if @room.keys.any? %>
  <table>
    <thead>
      <tr>
        <th>鍵種別</th>
        <th>鍵番号</th>
        <th>状態</th>
      </tr>
    </thead>
    <tbody>
      <% @room.keys.each do |key| %>
        <tr>
          <td><%= link_to key.key_type_label, key %></td>
          <td><%= key.key_number %></td>
          <td><%= key.status_label %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>鍵が登録されていません。</p>
<% end %>

<%= link_to "この部屋に鍵を追加", new_key_path(room_id: @room.id), class: "btn btn-primary" %>
